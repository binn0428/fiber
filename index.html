<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…‰çº–ç®¡ç†ç³»çµ±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        #app-status-log {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            max-height: 150px;
            overflow-y: auto;
            background: rgba(0,0,0,0.8);
            color: #0f0;
            font-family: monospace;
            padding: 10px;
            z-index: 9999;
            font-size: 12px;
            display: none; /* Hidden by default, shown on error or init */
        }
        #protocol-warning {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            color: white;
            z-index: 10000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="protocol-warning">
        <h1>âš ï¸ éŒ¯èª¤çš„é–‹å•Ÿæ–¹å¼</h1>
        <p>æª¢æ¸¬åˆ°æ‚¨æ­£åœ¨ä½¿ç”¨æª”æ¡ˆå”å®š (file://) é–‹å•Ÿæ­¤ç¶²é ã€‚</p>
        <p>ç”±æ–¼å®‰å…¨æ€§é™åˆ¶ï¼Œæœ¬ç³»çµ±å¿…é ˆé€éç¶²é ä¼ºæœå™¨é–‹å•Ÿã€‚</p>
        <p>è«‹ä½¿ç”¨çµ‚ç«¯æ©ŸåŸ·è¡Œ <code>npm run dev</code> ä¸¦é»æ“Šé¡¯ç¤ºçš„é€£çµã€‚</p>
    </div>
    <div id="app-status-log">ç³»çµ±åˆå§‹åŒ–ä¸­...</div>
    <script>
        // Protocol Check
        if (window.location.protocol === 'file:') {
            document.getElementById('protocol-warning').style.display = 'flex';
        } else {
            document.getElementById('app-status-log').style.display = 'block';
        }

        // Global Logger
        window.logToScreen = function(msg, type='info') {
            const el = document.getElementById('app-status-log');
            if (el) {
                const line = document.createElement('div');
                line.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
                if (type === 'error') line.style.color = '#ff6b6b';
                el.appendChild(line);
                el.scrollTop = el.scrollHeight;
            }
            console.log(msg);
        };
        window.onerror = function(msg, url, line) {
            window.logToScreen(`Global Error: ${msg} (${url}:${line})`, 'error');
        };
        
        window.addEventListener('unhandledrejection', function(event) {
             window.logToScreen(`Unhandled Promise Rejection: ${event.reason}`, 'error');
        });
    </script>
    <script type="module">
        import './src/main.js';
        window.logToScreen("Main module import started.");
    </script>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">å…‰çº–ç®¡ç†ç³»çµ±</div>
            <nav>
                <button class="nav-btn active" data-target="dashboard">å„€è¡¨æ¿ (Dashboard)</button>
                <button class="nav-btn" data-target="map-view">å…‰çº–æ¶æ§‹åœ– (Map)</button>
                <button class="nav-btn" data-target="data-mgmt">è³‡æ–™ç®¡ç† (Data)</button>
                <button class="nav-btn" data-target="manual-add">æ‰‹å‹•æ–°å¢ (Add)</button>
                <button class="nav-btn" data-target="io-panel">ä¸Šå‚³/åŒ¯å‡º (IO)</button>
            </nav>
            <div class="search-box">
                <input type="text" id="global-search" placeholder="æœå°‹ç·šè·¯ç·¨è™Ÿ...">
                <button id="search-btn">ğŸ”</button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Section -->
            <section id="dashboard" class="view-section active">
                <h2>ç³»çµ±å„€è¡¨æ¿</h2>
                <div id="stats-container" class="stats-grid">
                    <!-- Statistics will be injected here -->
                    <div class="stat-card">è¼‰å…¥ä¸­...</div>
                </div>
            </section>

            <!-- Map Section -->
            <section id="map-view" class="view-section">
                <h2>å…‰çº–æ¶æ§‹åœ–</h2>
                <div class="map-container">
                    <!-- Placeholder for Map. Ideally an SVG or Canvas -->
                    <div id="fiber-map">
                        <div class="map-placeholder">
                            <p>å…‰çº–æ¶æ§‹åœ–å€åŸŸ</p>
                            <p>é»æ“Šä¸‹æ–¹æ¨¡æ“¬ç«™é»æŸ¥çœ‹è©³æƒ…</p>
                            <div class="site-node" data-site="SiteA" style="top: 20%; left: 20%;">ç«™é» A</div>
                            <div class="site-node" data-site="SiteB" style="top: 20%; left: 60%;">ç«™é» B</div>
                            <div class="site-node" data-site="SiteC" style="top: 60%; left: 40%;">ç«™é» C</div>
                            <!-- Connection Lines -->
                            <svg class="connections">
                                <line x1="20%" y1="20%" x2="60%" y2="20%" stroke="blue" stroke-width="2" />
                                <line x1="60%" y1="20%" x2="40%" y2="60%" stroke="blue" stroke-width="2" />
                                <line x1="40%" y1="60%" x2="20%" y2="20%" stroke="blue" stroke-width="2" />
                            </svg>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Data Management Section -->
            <section id="data-mgmt" class="view-section">
                <h2>è³‡æ–™ç®¡ç†</h2>
                <div class="data-controls">
                    <select id="site-selector">
                        <option value="">é¸æ“‡ç«™é»...</option>
                    </select>
                </div>
                <div class="table-container">
                    <table id="data-table">
                        <thead>
                            <tr>
                                <th>ç«™é»</th>
                                <th>ç·šè·¯åç¨±</th>
                                <th>ç›®çš„</th>
                                <th>èŠ¯æ•¸</th>
                                <th>ä¾†æº</th>
                                <th>Port</th>
                                <th>ç”¨é€”</th>
                                <th>å‚™è¨»</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data rows -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Manual Add Section (New) -->
            <section id="manual-add" class="view-section">
                <h2>æ‰‹å‹•æ–°å¢è³‡æ–™</h2>
                <form id="add-form" class="data-form">
                    <div class="form-group">
                        <label>ç«™é»åç¨±</label>
                        <input type="text" name="station_name" required>
                    </div>
                    <div class="form-group">
                        <label>ç·šè·¯åç¨±</label>
                        <input type="text" name="fiber_name" required>
                    </div>
                    <div class="form-group">
                        <label>èŠ¯æ•¸</label>
                        <input type="text" name="core_count">
                    </div>
                     <div class="form-group">
                        <label>ç·šè·¯ç›®çš„</label>
                        <input type="text" name="destination">
                    </div>
                     <div class="form-group">
                        <label>ç·šè·¯ä¾†æº</label>
                        <input type="text" name="source">
                    </div>
                     <div class="form-group">
                        <label>Port</label>
                        <input type="text" name="port">
                    </div>
                    <div class="form-group">
                        <label>ç”¨é€”</label>
                        <input type="text" name="usage">
                    </div>
                    <div class="form-group">
                        <label>å‚™è¨»</label>
                        <input type="text" name="notes">
                    </div>
                    <button type="submit" class="btn-primary">æ–°å¢</button>
                </form>
            </section>

            <!-- IO Section -->
            <section id="io-panel" class="view-section">
                <h2>ä¸Šå‚³ / åŒ¯å‡º</h2>
                <div class="io-card">
                    <h3>åŒ¯å…¥ Excel</h3>
                    <p>è«‹ä¸Šå‚³åŒ…å«å¤šå€‹åˆ†é ï¼ˆç«™é»ï¼‰çš„ .xlsx æª”æ¡ˆ</p>
                    <input type="file" id="excel-upload" accept=".xlsx, .xls">
                    <button id="process-upload-btn">è§£æä¸¦ä¸Šå‚³</button>
                </div>
                <div class="io-card">
                    <h3>åŒ¯å‡º Excel</h3>
                    <p>å°‡ç•¶å‰ç³»çµ±è³‡æ–™åŒ¯å‡ºç‚º .xlsx</p>
                    <button id="export-btn">ä¸‹è¼‰ Excel</button>
                </div>
                <div class="io-card">
                    <h3>Supabase è¨­å®š</h3>
                    <input type="text" id="supabase-url" placeholder="Supabase URL">
                    <input type="password" id="supabase-key" placeholder="Supabase Key">
                    <button id="save-config-btn">å„²å­˜è¨­å®š</button>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <!-- Path Modal -->
    <div id="path-modal" class="modal hidden">
        <div class="modal-content large-modal">
            <span class="close-modal">&times;</span>
            <h2 id="modal-path-title">å…‰çº–è·¯å¾‘åœ–</h2>
            <div id="path-container" class="path-diagram">
                <!-- Path visualization will be here -->
            </div>
        </div>
    </div>

    <!-- Site Details Modal -->
    <div id="site-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3 id="modal-site-title">ç«™é»è©³æƒ…</h3>
            <div id="modal-site-stats"></div>
            <div class="modal-table-wrapper">
                <table id="modal-table">
                    <thead>
                        <tr>
                            <th>ç«™é»</th>
                            <th>ç·šè·¯åç¨±</th>
                            <th>ç›®çš„</th>
                            <th>èŠ¯æ•¸</th>
                            <th>ä¾†æº</th>
                            <th>Port</th>
                            <th>ç”¨é€”</th>
                            <th>å‚™è¨»</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="edit-modal" class="modal hidden">
        <div class="modal-content sm">
            <span class="close-modal">&times;</span>
            <h3>ç·¨è¼¯ Port è³‡è¨Š</h3>
            <form id="edit-form">
                <input type="hidden" id="edit-id">
                <div class="form-group">
                    <label>ç”¨é€”</label>
                    <input type="text" id="edit-usage">
                </div>
                <div class="form-group">
                    <label>å‚™è¨»</label>
                    <input type="text" id="edit-remarks">
                </div>
                <button type="submit">å„²å­˜</button>
            </form>
        </div>
    </div>
</body>
</html>
